{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["// HTTP-–∑–∞–ø–∏—Ç–∏ –¥–æ Pixabay API (axios, async/await)\nimport axios from \"axios\"\n\nconst BASE_URL = \"https://pixabay.com/api/\"\n\nfunction getApiKey() {\n  return import.meta.env.VITE_PIXABAY_API_KEY || \"\"\n}\n\nexport async function getImagesByQuery(query, page = 1) {\n  const key = getApiKey()\n  if (!key || !String(key).trim()) {\n    throw new Error(\"MISSING_API_KEY\")\n  }\n\n  const params = {\n    key: key.trim(),\n    q: String(query).trim(),\n    image_type: \"photo\",\n    orientation: \"horizontal\",\n    safesearch: true,\n    page: Number(page) || 1,\n    per_page: 15\n  }\n\n  const response = await axios.get(BASE_URL, {params})\n  return response.data\n}\n","import SimpleLightbox from \"simplelightbox\"\nimport \"simplelightbox/dist/simple-lightbox.min.css\"\n\nconst galleryEl = document.querySelector(\".gallery\")\nconst loaderEl = document.querySelector(\".loader-wrap\")\nconst loadMoreBtnEl = document.querySelector(\".btn-load-more\")\n\nlet lightboxInstance = null\n\nfunction createCardMarkup(img) {\n  const {\n    webformatURL,\n    largeImageURL,\n    tags = \"\",\n    likes = 0,\n    views = 0,\n    comments = 0,\n    downloads = 0\n  } = img\n\n  const raw = String(tags).slice(0, 200)\n  const safe = raw\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&#39;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n\n  return `\n<li class=\"gallery-item\">\n  <a class=\"gallery-item__link\" href=\"${largeImageURL}\" title=\"${safe}\">\n    <img\n      class=\"gallery-item__img\"\n      src=\"${webformatURL}\"\n      alt=\"${safe}\"\n      loading=\"lazy\"\n      width=\"640\"\n      height=\"360\"\n    />\n    <div class=\"gallery-item__info\">\n      <span class=\"gallery-item__info-item\">‚ù§Ô∏è ${likes}</span>\n      <span class=\"gallery-item__info-item\">üëÅ ${views}</span>\n      <span class=\"gallery-item__info-item\">üí¨ ${comments}</span>\n      <span class=\"gallery-item__info-item\">‚¨á ${downloads}</span>\n    </div>\n  </a>\n</li>`\n}\n\nexport function createGallery(images, append = false) {\n  if (!galleryEl) return\n\n  if (!Array.isArray(images) || images.length === 0) {\n    if (!append) galleryEl.innerHTML = \"\"\n    return\n  }\n\n  const markup = images.map(createCardMarkup).join(\"\")\n\n  if (append) {\n    galleryEl.insertAdjacentHTML(\"beforeend\", markup)\n  } else {\n    galleryEl.innerHTML = markup\n  }\n\n  if (!lightboxInstance) {\n    lightboxInstance = new SimpleLightbox(\".gallery a\", {\n      captionsData: \"title\",\n      captionDelay: 250\n    })\n  } else {\n    lightboxInstance.refresh()\n  }\n}\n\nexport function clearGallery() {\n  if (galleryEl) galleryEl.innerHTML = \"\"\n}\n\nexport function showLoader() {\n  if (loaderEl) loaderEl.classList.remove(\"is-hidden\")\n}\n\nexport function hideLoader() {\n  if (loaderEl) loaderEl.classList.add(\"is-hidden\")\n}\n\nexport function showLoadMoreButton() {\n  if (loadMoreBtnEl) loadMoreBtnEl.classList.remove(\"is-hidden\")\n}\n\nexport function hideLoadMoreButton() {\n  if (loadMoreBtnEl) loadMoreBtnEl.classList.add(\"is-hidden\")\n}\n","// –õ–æ–≥—ñ–∫–∞ –¥–æ–¥–∞—Ç–∫—É: —Ñ–æ—Ä–º–∞, Load more, iziToast, scroll ‚Äî –¢–ó main.js\nimport iziToast from \"izitoast\"\nimport \"izitoast/dist/css/iziToast.min.css\"\n\nimport {getImagesByQuery} from \"./js/pixabay-api.js\"\nimport {\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton\n} from \"./js/render-functions.js\"\n\nconst PER_PAGE = 15\nconst formEl = document.querySelector(\".form\")\nconst loadMoreBtnEl = document.querySelector(\".btn-load-more\")\nconst galleryEl = document.querySelector(\".gallery\")\nconst endMessageEl = document.querySelector(\".end-message\")\n\nlet currentQuery = \"\"\nlet currentPage = 1\n\nfunction hideEndMessage() {\n  if (endMessageEl) endMessageEl.classList.add(\"is-hidden\")\n}\n\nfunction showEndMessage() {\n  if (endMessageEl) endMessageEl.classList.remove(\"is-hidden\")\n}\n\nfunction isEndOfCollection(totalHits) {\n  return currentPage * PER_PAGE >= totalHits\n}\n\nfunction getIziToastError(err) {\n  let msg = \"Something went wrong. Please try again.\"\n  if (err.message === \"MISSING_API_KEY\") {\n    msg =\n      \"Pixabay API key is missing. Create .env and add VITE_PIXABAY_API_KEY=your_key (get key: https://pixabay.com/api/docs/)\"\n  } else if (err.response?.status === 429) {\n    msg = \"Too many requests. Please try again later.\"\n  } else if (err.response?.status === 400) {\n    msg = \"Invalid request (e.g. missing API key). Check .env and VITE_PIXABAY_API_KEY.\"\n  } else if (err.message) {\n    msg = err.message\n  }\n  return msg\n}\n\nfunction scrollAfterLoadMore() {\n  if (!galleryEl) return\n  const card = galleryEl.querySelector(\".gallery-item\")\n  if (!card) return\n  const {height} = card.getBoundingClientRect()\n  window.scrollBy({top: 2 * height, behavior: \"smooth\"})\n}\n\nasync function handleSearchSubmit(event) {\n  event.preventDefault()\n\n  const input = formEl?.querySelector('input[name=\"search-text\"]')\n  const query = input ? input.value.trim() : \"\"\n  if (!query) return\n\n  currentQuery = query\n  currentPage = 1\n\n  hideLoadMoreButton()\n  hideEndMessage()\n  showLoader()\n  clearGallery()\n\n  try {\n    const data = await getImagesByQuery(query, 1)\n    hideLoader()\n\n    if (!data || !Array.isArray(data.hits)) {\n      iziToast.info({\n        title: \"Info\",\n        message: \"Sorry, there are no images matching your search query. Please try again!\",\n        position: \"topRight\",\n        timeout: 4000\n      })\n      return\n    }\n\n    if (data.hits.length === 0) {\n      iziToast.info({\n        title: \"Info\",\n        message: \"Sorry, there are no images matching your search query. Please try again!\",\n        position: \"topRight\",\n        timeout: 4000\n      })\n      return\n    }\n\n    createGallery(data.hits)\n\n    if (isEndOfCollection(data.totalHits)) {\n      hideLoadMoreButton()\n      showEndMessage()\n    } else {\n      showLoadMoreButton()\n    }\n  } catch (err) {\n    hideLoader()\n    iziToast.error({\n      title: \"Error\",\n      message: getIziToastError(err),\n      position: \"topRight\",\n      timeout: 6000\n    })\n  }\n}\n\nasync function handleLoadMore() {\n  if (!currentQuery) return\n\n  const nextPage = currentPage + 1\n  showLoader()\n\n  try {\n    const data = await getImagesByQuery(currentQuery, nextPage)\n    hideLoader()\n\n    if (!data || !Array.isArray(data.hits) || data.hits.length === 0) {\n      hideLoadMoreButton()\n      showEndMessage()\n      return\n    }\n\n    currentPage = nextPage\n    createGallery(data.hits, true)\n\n    if (isEndOfCollection(data.totalHits)) {\n      hideLoadMoreButton()\n      showEndMessage()\n    }\n\n    scrollAfterLoadMore()\n  } catch (err) {\n    hideLoader()\n    iziToast.error({\n      title: \"Error\",\n      message: getIziToastError(err),\n      position: \"topRight\",\n      timeout: 6000\n    })\n  }\n}\n\nif (formEl) {\n  formEl.addEventListener(\"submit\", handleSearchSubmit)\n}\n\nif (loadMoreBtnEl) {\n  loadMoreBtnEl.addEventListener(\"click\", handleLoadMore)\n}\n"],"names":["BASE_URL","getApiKey","getImagesByQuery","query","page","key","params","axios","galleryEl","loaderEl","loadMoreBtnEl","lightboxInstance","createCardMarkup","img","webformatURL","largeImageURL","tags","likes","views","comments","downloads","safe","createGallery","images","append","markup","SimpleLightbox","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","PER_PAGE","formEl","endMessageEl","currentQuery","currentPage","hideEndMessage","showEndMessage","isEndOfCollection","totalHits","getIziToastError","err","msg","scrollAfterLoadMore","card","height","handleSearchSubmit","event","input","data","iziToast","handleLoadMore","nextPage"],"mappings":"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"}